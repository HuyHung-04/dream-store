<div *ngIf="hoaDonData; else noData" class="invoice-container">
  <!-- MÃ£ hÃ³a Ä‘Æ¡n (CÄƒn pháº£i) -->
  <div class="invoice-header">
    <h3>Chi tiáº¿t Ä‘Æ¡n hÃ ng</h3>
    <p class="invoice-code"><strong>MÃ£ Ä‘Æ¡n hÃ ng:</strong> {{ hoaDonData.ma }}</p>
  </div>

  <!-- Náº¿u tráº¡ng thÃ¡i hÃ³a Ä‘Æ¡n lÃ  5 (ÄÆ¡n hÃ ng Ä‘Ã£ há»§y), chá»‰ hiá»ƒn thá»‹ thÃ´ng bÃ¡o nÃ y -->
  <div *ngIf="hoaDonData.trangThai == 5">
    <div class="cancelHoaDon">
      <p><i class="bi bi-x-circle"></i> ÄÆ¡n hÃ ng Ä‘Ã£ bá»‹ há»§y</p>
      <p *ngIf="hoaDonData?.trangThai === 5 && hoaDonData?.ghiChu" style="font-size: 15px;color: black;">
        (LÃ½ do há»§y Ä‘Æ¡n: {{ hoaDonData.ghiChu }})
      </p>
    </div>
  </div>

  <div class="status-tracker" *ngIf="hoaDonData.trangThai != 5">
    <div class="status-step" [class.active]="hoaDonData.trangThai == 1" style="margin-top: 20px;">
      <div class="status-icon">ğŸ“„</div>
      <p>Chá» xÃ¡c nháº­n</p>
      <span style="margin-top: 4px; font-size: 0.8rem; color: gray;">{{hoaDonData.ngayTao}}</span>
    </div>

    <div class="status-line" [class.active]="hoaDonData.trangThai == 2"></div>
    <div class="status-step" [class.active]="hoaDonData.trangThai == 2">
      <div class="status-icon">âœ”ï¸</div>
      <p>ÄÃ£ Ä‘Æ°á»£c xÃ¡c nháº­n</p>
    </div>

    <div class="status-line" [class.active]="hoaDonData.trangThai == 3"></div>
    <div class="status-step" [class.active]="hoaDonData.trangThai == 3">
      <div class="status-icon">ğŸšš</div>
      <p>Äang giao hÃ ng</p>
    </div>

    <div class="status-line" [class.active]="hoaDonData.trangThai == 4"></div>
    <div class="status-step" [class.active]="hoaDonData.trangThai == 4" style="margin-top: 10px;">
      <div class="status-icon">ğŸ“¦</div>
      <p>Giao hÃ ng thÃ nh cÃ´ng</p>
      <span style="margin-top: 4px; font-size: 0.8rem; color: gray;">{{hoaDonData.ngaySua}}</span>
    </div>
  </div>


  <!-- Äá»‹a chá»‰ nháº­n hÃ ng -->
  <section class="section" style="margin-top: 30px;">
    <h3>ThÃ´ng tin khÃ¡ch hÃ ng</h3>
    <p><strong>TÃªn ngÆ°á»i nháº­n:</strong> {{ hoaDonData.tenNguoiNhan }}</p>
    <p><strong>Sá»‘ Ä‘iá»‡n thoáº¡i: </strong>{{ hoaDonData.sdtNguoiNhan }}</p>
    <!-- Chá»‰ hiá»ƒn thá»‹ náº¿u Ä‘á»‹a chá»‰ khÃ¡ch hÃ ng cÃ³ dá»¯ liá»‡u -->
    <p *ngIf="hoaDonData.diaChiNhanHang"><strong>Äá»‹a chá»‰:</strong> {{ hoaDonData.diaChiNhanHang }}</p>

  </section>

  <!-- Chi tiáº¿t hÃ³a Ä‘Æ¡n -->
  <section class="section">
    <div *ngFor="let item of hoaDonChiTietData" class="invoice-details-item">
      <img [src]="'http://localhost:8080' + item.anhUrls" alt="{{ item.tenSanPham }}" />
      <div class="invoice-details-info">
        <p><strong>TÃªn Sáº£n Pháº©m:</strong> {{ item.tenSanPham }} ({{item.maSanPham}})</p>
        <p><strong>PhÃ¢n loáº¡i hÃ ng: </strong>({{ item.mauSac }} / {{item.size}})</p>
        <p><strong>ÄÆ¡n GiÃ¡:</strong> {{ item.donGia | number }} VND (x{{ item.soLuong }})</p>

        <p></p>
        <p><strong>ThÃ nh Tiá»n:</strong> {{ item.donGia * item.soLuong | number }} VNÄ</p>
      </div>
    </div>
  </section>

  <!-- Chi tiáº¿t thanh toÃ¡n -->
  <section class="section">
    <p><strong>Táº¡m tÃ­nh:</strong> {{ hoaDonData.tongTienTruocVoucher | number }} VNÄ</p>
    <!-- Äiá»u kiá»‡n hiá»ƒn thá»‹ voucher vÃ  giÃ¡ trá»‹ giáº£m -->
    <div *ngIf="hoaDonData.voucher">
      <p>
        <strong>TÃªn voucher:</strong> {{ hoaDonData.voucher?.ten }}

        <!-- Hiá»‡n náº¿u giáº£m % vÃ  khÃ´ng vÆ°á»£t giáº£m tá»‘i Ä‘a -->
        <span *ngIf="showGiamPhanTram">
          (Giáº£m: {{ hoaDonData.voucher?.giaTriGiam }}%)
        </span>

        <!-- Hiá»‡n náº¿u giáº£m % nhÆ°ng vÆ°á»£t quÃ¡ má»©c giáº£m tá»‘i Ä‘a -->
        <span *ngIf="showGiamToiDa">
          (Giáº£m tá»‘i Ä‘a: {{ hoaDonData.voucher?.giamToiDa | number }} VNÄ)
        </span>

        <!-- Hiá»‡n náº¿u giáº£m báº±ng sá»‘ tiá»n -->
        <span *ngIf="hoaDonData.voucher?.hinhThucGiam === true">
          (Giáº£m: {{ hoaDonData.voucher?.giaTriGiam | number }} VNÄ)
        </span>
      </p>
    </div>

    <!-- Náº¿u khÃ´ng cÃ³ voucher thÃ¬ khÃ´ng hiá»ƒn thá»‹ thÃ´ng tin voucher -->
    <p *ngIf="!hoaDonData.voucher"><strong>HÃ³a Ä‘Æ¡n khÃ´ng Ã¡p dá»¥ng voucher</strong></p>
    <p><strong>PhÆ°Æ¡ng thá»©c thanh toÃ¡n:</strong> {{ hoaDonData.phuongThucThanhToan?.ten }}</p>
    <p *ngIf="hoaDonData.phiVanChuyen && hoaDonData.phiVanChuyen > 0">
      <strong>PhÃ­ váº­n chuyá»ƒn:</strong> {{ hoaDonData.phiVanChuyen | number }} VNÄ
    </p>
    <p><strong>Tá»•ng tiá»n thanh toÃ¡n:</strong> {{ hoaDonData.tongTienThanhToan | number }} VNÄ</p>
  </section>

  <!-- NÃºt Há»§y vÃ  NÃºt Quay Vá» Trang Chá»§ -->
  <div class="button-container">
    <!-- NÃºt há»§y -->
    <button *ngIf="!([5,2,3,4].includes(hoaDonData.trangThai))" (click)="openCancelModal()" class="btn-danger">
      Há»§y Ä‘Æ¡n hÃ ng
    </button>

    <!-- Modal nháº­p lÃ½ do há»§y -->
    <div class="modal-overlay-huy" *ngIf="showCancelModal">
      <div class="modal-huy">
        <h4>Nháº­p lÃ½ do há»§y Ä‘Æ¡n hÃ ng</h4>
        <textarea [(ngModel)]="ghiChu" rows="4" placeholder="Nháº­p lÃ½ do..."></textarea>
        <div class="modal-buttons">
          <button class="btn btn-danger" (click)="huyHoaDon()">XÃ¡c nháº­n há»§y</button>
          <button class="btn btn-secondary" (click)="closeCancelModal()">Há»§y</button>
        </div>
      </div>
    </div>
    <button (click)="goHome()" class="btn btn-primary">Vá» Trang Chá»§</button>
  </div>
</div>



<!-- Náº¿u chÆ°a cÃ³ dá»¯ liá»‡u -->
<ng-template #noData>
  <!-- <p>ChÆ°a cÃ³ dá»¯ liá»‡u hÃ³a Ä‘Æ¡n Ä‘á»ƒ hiá»ƒn thá»‹.</p> -->
</ng-template>