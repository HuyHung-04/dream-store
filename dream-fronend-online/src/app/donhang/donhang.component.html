<div *ngIf="hoaDonData; else noData" class="invoice-container">
  <!-- M√£ h√≥a ƒë∆°n (CƒÉn ph·∫£i) -->
  <div class="invoice-header">
    <h3>Chi ti·∫øt ƒë∆°n h√†ng</h3>
    <p class="invoice-code"><strong>M√£ ƒë∆°n h√†ng:</strong> {{ hoaDonData.ma }}</p>
  </div>

  <!-- N·∫øu tr·∫°ng th√°i h√≥a ƒë∆°n l√† 5 (ƒê∆°n h√†ng ƒë√£ h·ªßy), ch·ªâ hi·ªÉn th·ªã th√¥ng b√°o n√†y -->
  <div *ngIf="hoaDonData.trangThai == 9">
    <div class="cancelHoaDon">
      <p><i class="bi bi-x-circle"></i> ƒê∆°n h√†ng ƒë√£ b·ªã h·ªßy</p>
      <p *ngIf="hoaDonData?.trangThai === 9 && hoaDonData?.ghiChu" style="font-size: 15px;color: black;">
        (L√Ω do h·ªßy ƒë∆°n: {{ hoaDonData.ghiChu }})
      </p>
    </div>
  </div>

  <div class="status-tracker" *ngIf="hoaDonData.trangThai != 9">
    <div class="status-step" [class.active]="hoaDonData.trangThai == 1" style="margin-top: 20px;">
      <div class="status-icon">üìÑ</div>
      <p>Ch·ªù x√°c nh·∫≠n</p>
      <span style="margin-top: 4px; font-size: 0.8rem; color: gray;">{{hoaDonData.ngayTao}}</span>
    </div>

    <div class="status-line" [class.active]="hoaDonData.trangThai == 2"></div>
    <div class="status-step" [class.active]="hoaDonData.trangThai == 2">
      <div class="status-icon">‚úîÔ∏è</div>
      <p>ƒê√£ ƒë∆∞·ª£c x√°c nh·∫≠n</p>
    </div>

    <div class="status-line" [class.active]="hoaDonData.trangThai == 3"></div>
    <div class="status-step" [class.active]="hoaDonData.trangThai == 3">
      <div class="status-icon">‚è≥</div>
      <p>Ch·ªù l·∫•y h√†ng</p>
    </div>

    <div class="status-line" [class.active]="hoaDonData.trangThai == 4"></div>
    <div class="status-step" [class.active]="hoaDonData.trangThai == 4">
      <div class="status-icon">üöö</div>
      <p>ƒêang giao h√†ng</p>
    </div>

    <div class="status-line" [class.active]="hoaDonData.trangThai == 5"></div>
    <div class="status-step" [class.active]="hoaDonData.trangThai == 5" style="margin-top: 10px;">
      <div class="status-icon">üì¶</div>
      <p>Giao h√†ng th√†nh c√¥ng</p>
      <span style="margin-top: 4px; font-size: 0.8rem; color: gray;">{{hoaDonData.ngaySua}}</span>
    </div>
  </div>


  <!-- ƒê·ªãa ch·ªâ nh·∫≠n h√†ng -->
  <section class="section" style="margin-top: 30px;">
    <h3>Th√¥ng tin kh√°ch h√†ng</h3>
    <p><strong>T√™n ng∆∞·ªùi nh·∫≠n:</strong> {{ hoaDonData.tenNguoiNhan }}</p>
    <p><strong>S·ªë ƒëi·ªán tho·∫°i: </strong>{{ hoaDonData.sdtNguoiNhan }}</p>
    <!-- Ch·ªâ hi·ªÉn th·ªã n·∫øu ƒë·ªãa ch·ªâ kh√°ch h√†ng c√≥ d·ªØ li·ªáu -->
    <p *ngIf="hoaDonData.diaChiNhanHang"><strong>ƒê·ªãa ch·ªâ:</strong> {{ hoaDonData.diaChiNhanHang }}</p>

  </section>

  <!-- Chi ti·∫øt h√≥a ƒë∆°n -->
  <section class="section">
    <div *ngFor="let item of hoaDonChiTietData" class="invoice-details-item">
      <img [src]="'http://localhost:8080' + item.anhUrls" alt="{{ item.tenSanPham }}" />
      <div class="invoice-details-info">
        <p><strong>T√™n S·∫£n Ph·∫©m:</strong> {{ item.tenSanPham }} ({{item.maSanPham}})</p>
        <p><strong>Ph√¢n lo·∫°i h√†ng: </strong>({{ item.mauSac }} / {{item.size}})</p>
        <p><strong>ƒê∆°n Gi√°:</strong> {{ item.donGia | number }} VND (x{{ item.soLuong }})</p>

        <p></p>
        <p><strong>Th√†nh Ti·ªÅn:</strong> {{ item.donGia * item.soLuong | number }} VND</p>
      </div>
    </div>
  </section>

  <!-- Chi ti·∫øt thanh to√°n -->
  <section class="section">
    <p><strong>T·∫°m t√≠nh:</strong> {{ hoaDonData.tongTienTruocVoucher | number }} VND</p>
    <!-- ƒêi·ªÅu ki·ªán hi·ªÉn th·ªã voucher v√† gi√° tr·ªã gi·∫£m -->
    <div *ngIf="hoaDonData.voucher">
      <p>
        <strong>T√™n voucher:</strong> {{ hoaDonData.voucher?.ten }}

        <!-- Hi·ªán n·∫øu gi·∫£m % v√† kh√¥ng v∆∞·ª£t gi·∫£m t·ªëi ƒëa -->
        <span *ngIf="showGiamPhanTram">
          (Gi·∫£m: {{ hoaDonData.voucher?.giaTriGiam }}%)
        </span>

        <!-- Hi·ªán n·∫øu gi·∫£m % nh∆∞ng v∆∞·ª£t qu√° m·ª©c gi·∫£m t·ªëi ƒëa -->
        <span *ngIf="showGiamToiDa">
          (Gi·∫£m t·ªëi ƒëa: {{ hoaDonData.voucher?.giamToiDa | number }} VND)
        </span>

        <!-- Hi·ªán n·∫øu gi·∫£m b·∫±ng s·ªë ti·ªÅn -->
        <span *ngIf="hoaDonData.voucher?.hinhThucGiam === true">
          (Gi·∫£m: {{ hoaDonData.voucher?.giaTriGiam | number }} VND)
        </span>
      </p>
    </div>

    <!-- N·∫øu kh√¥ng c√≥ voucher th√¨ kh√¥ng hi·ªÉn th·ªã th√¥ng tin voucher -->
    <p *ngIf="!hoaDonData.voucher"><strong>H√≥a ƒë∆°n kh√¥ng √°p d·ª•ng voucher</strong></p>
    <p><strong>Ph∆∞∆°ng th·ª©c thanh to√°n:</strong> {{ hoaDonData.phuongThucThanhToan?.ten }}</p>
    <p *ngIf="hoaDonData.phiVanChuyen && hoaDonData.phiVanChuyen > 0">
      <strong>Ph√≠ v·∫≠n chuy·ªÉn:</strong> {{ hoaDonData.phiVanChuyen | number }} VND
    </p>
    <p><strong>T·ªïng ti·ªÅn thanh to√°n:</strong> {{ hoaDonData.tongTienThanhToan | number }} VND</p>
  </section>

  <!-- N√∫t H·ªßy v√† N√∫t Quay V·ªÅ Trang Ch·ªß -->
  <div class="button-container">
    <!-- N√∫t h·ªßy -->
    <button *ngIf="!([2,3,4,5,9].includes(hoaDonData.trangThai))" (click)="openCancelModal()" class="btn-danger">
      H·ªßy ƒë∆°n h√†ng
    </button>

    <!-- Modal nh·∫≠p l√Ω do h·ªßy -->
    <div class="modal-overlay-huy" *ngIf="showCancelModal">
      <div class="modal-huy">
        <h4>Nh·∫≠p l√Ω do h·ªßy ƒë∆°n h√†ng</h4>
        <textarea [(ngModel)]="ghiChu" rows="4" placeholder="Nh·∫≠p l√Ω do..."></textarea>
        <div class="modal-buttons">
          <button class="btn btn-danger" (click)="huyHoaDon()">X√°c nh·∫≠n h·ªßy</button>
          <button class="btn btn-secondary" (click)="closeCancelModal()">H·ªßy</button>
        </div>
      </div>
    </div>
    <button (click)="goHome()" class="btn btn-primary">V·ªÅ Trang Ch·ªß</button>
  </div>
</div>



<!-- N·∫øu ch∆∞a c√≥ d·ªØ li·ªáu -->
<ng-template #noData>
  <!-- <p>Ch∆∞a c√≥ d·ªØ li·ªáu h√≥a ƒë∆°n ƒë·ªÉ hi·ªÉn th·ªã.</p> -->
</ng-template>