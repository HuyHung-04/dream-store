<div class="hoa-don">
  <h2 style="color: #294764; padding-top: 10px; font-weight: bold; font-size: 18px;">
    Quản lý hóa đơn
  </h2>

  <!-- Phần tìm kiếm -->
  <div class="tim-kiem">
    <p style="color: #294764; margin-top: -20px; font-weight: bold; font-size: 14px;">Tìm kiếm</p>
    <div class="input-row">
      <div class="input-field">
        <label for="maHoaDon">Mã hóa đơn</label>
        <input type="text" id="maHoaDon" placeholder="Nhập mã hóa đơn..." [(ngModel)]="searchRequest.maHoaDon">
      </div>
      <div class="input-field">
        <label for="tenKhachHang">Tên khách hàng</label>
        <input type="text" id="tenKhachHang" placeholder="Nhập tên khách hàng..." [(ngModel)]="searchRequest.tenKhachHang">
      </div>
      <div class="input-field">
        <label for="tenNhanVien">Tên nhân viên</label>
        <input type="text" id="tenNhanVien" placeholder="Nhập tên nhân viên..." [(ngModel)]="searchRequest.tenNhanVien">
      </div>
      <div class="input-field">
        <button (click)="search()">Tìm kiếm</button>
        <button (click)="resetFilters()">Reset</button>
      </div>
    </div>
  </div>

  <!-- Bảng hiển thị hóa đơn -->
  <div class="table-don-off">
    <div class="table-wrapper">
      <table>
        <thead>
        <tr>
          <th>Mã hóa đơn</th>
          <th>Tên khách hàng</th>
          <th>Tên nhân viên</th>
          <th>Phương thức thanh toán</th>
          <th>Tiền trước voucher</th>
          <th>Voucher</th>
          <th>Tổng tiền</th>
          <th>Ghi chú</th>
          <th>Trạng thái</th>
          <th>Ngày tạo</th>
          <th>Xem chi tiết</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let invoice of hoaDons.content; trackBy: trackById">
          <td>{{ invoice.maHoaDon }}</td>
          <td>{{ invoice.tenKhachHang }}</td>
          <td>{{ invoice.tenNhanVien }}</td>
          <td>{{ invoice.tenPhuongThucThanhToan }}</td>
          <td>{{ invoice.tongTienTruocVoucher | number:'1.0-0' }} VNĐ</td>
          <td>
              <span *ngIf="invoice.tenVoucher; else noVoucher">
                {{ invoice.tenVoucher }} (Giảm {{ invoice.giaTriGiam }}{{ invoice.hinhThucGiam ? ' %' : ' VNĐ' }})
              </span>
            <ng-template #noVoucher>Không</ng-template>
          </td>
          <td>{{ invoice.tongTienThanhToan | number:'1.0-0' }} VNĐ</td>
          <td>{{ invoice.ghiChu }}</td>
          <td>{{ invoice.trangThai }}</td>
          <td>{{ invoice.ngayTao | date:'yyyy-MM-dd' }}</td>
          <td>
            <button class="xem-chi-tiet" (click)="selectHoaDonChiTiet(invoice)">
              <i class="bi bi-eye-fill"></i>
            </button>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
    <!-- Phân trang -->
    <div class="pagination">
      <button (click)="prevPage()">Prev</button>
      <span>Trang {{ searchRequest.page }} / {{ hoaDons.totalElements % 10 }}</span>
      <button (click)="nextPage()">Next</button>
    </div>
  </div>

  <!-- Popup modal hiển thị chi tiết hóa đơn -->
  <div class="modal" *ngIf="showDetailPopup">
    <div class="modal-content">
      <span class="close" (click)="closePopup()">&times;</span>
      <h3>Chi tiết hóa đơn</h3>
      <div *ngIf="selectedInvoiceDetail; else loading">
        <p><strong>Mã hóa đơn:</strong> {{ selectedInvoiceDetail.maHoaDon }}</p>
        <p><strong>Tên khách hàng:</strong> {{ selectedInvoiceDetail.tenKhachHang }}</p>
        <p><strong>Tên nhân viên:</strong> {{ selectedInvoiceDetail.tenNhanVien }}</p>
        <p><strong>Voucher:</strong> {{ selectedInvoiceDetail.tenVoucher }} (Giảm {{ selectedInvoiceDetail.giaTriGiam }}{{ selectedInvoiceDetail.hinhThucGiam ? ' %' : ' VNĐ' }})</p>
        <p><strong>Tiền trước voucher:</strong> {{ selectedInvoiceDetail.tongTienTruocVoucher | number:'1.0-0' }} VNĐ</p>
        <p><strong>Tổng tiền:</strong> {{ selectedInvoiceDetail.tongTienThanhToan | number:'1.0-0' }} VNĐ</p>
        <p><strong>Ghi chú:</strong> {{ selectedInvoiceDetail.ghiChu }}</p>
        <p><strong>Ngày tạo:</strong> {{ selectedInvoiceDetail.ngayTao | date:'yyyy-MM-dd' }}</p>
        <!-- Bạn có thể hiển thị các trường khác theo yêu cầu -->
      </div>
      <ng-template #loading>
        <p>Đang tải dữ liệu...</p>
      </ng-template>
    </div>
  </div>
</div>
