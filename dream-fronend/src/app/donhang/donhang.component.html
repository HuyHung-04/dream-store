<h2 style="color: #294764; font-weight: bold; font-size: 18px;">
  Qu·∫£n l√Ω ƒë∆°n h√†ng
</h2>
<div style="margin-top: -20px;">
  <!-- B·ªô l·ªçc tr·∫°ng th√°i -->
  <div class="status-filter-container">
    <div class="status-filter">
      <button *ngFor="let trangThai of trangThai" [ngClass]="{'active': chonTrangThai === trangThai.value}"
        (click)="locTrangThai(trangThai.value)">
        {{ trangThai.label }}
      </button>
    </div>
  </div>

  <!-- t√¨m ki·∫øm s·ªë ƒëi·ªán tho·∫°i -->
  <div class="input-field-container">
    <div class="input-field">
      <label for="customerPhone">S·ªë ƒëi·ªán tho·∫°i kh√°ch h√†ng</label>
      <input type="text" id="customerPhone" [(ngModel)]="sdtNguoiNhan" (ngModelChange)="onSearchChange()" class="input"
        placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i..." style="width: 200px;">
    </div>

    <!-- t√¨m ki·∫øm m√£ h√≥a ƒë∆°n -->
    <div class="input-field">
      <label for="invoiceCode">M√£ h√≥a ƒë∆°n</label>
      <input style="width: 200px;" type="text" id="invoiceCode" [(ngModel)]="maHoaDon" (ngModelChange)="onSearchChange()"
        class="input" placeholder="Nh·∫≠p m√£ h√≥a ƒë∆°n...">
    </div>

    <!-- t√¨m ki·∫øm t√™n kh√°ch h√†ng -->
    <div class="input-field">
      <label for="tenKhachHang">T√™n kh√°ch h√†ng</label>
      <input style="width: 200px;" type="text" id="tenKhachHang" [(ngModel)]="tenNguoiNhan" (ngModelChange)="onSearchChange()"
        class="input" placeholder="Nh·∫≠p t√™n kh√°ch h√†ng...">
    </div>

    <div class="input-field">
      <label>
        <button class="xac-nhan" (click)="moModalSoLuongNo()">S·ªë l∆∞·ª£ng n·ª£</button>
      </label>
    </div>
  </div>

 <div class="modal-no" *ngIf="hienThiModalNo">
  <div class="modal-content-no">
    <!-- N√∫t ƒë√≥ng ·ªü g√≥c ph·∫£i -->
    <button class="close-button" (click)="dongModal()">‚úï</button>

    <h4 style="color: #294764;">Danh s√°ch s·∫£n ph·∫©m thi·∫øu</h4>

    <!-- B·∫£ng cu·ªôn t·ªëi ƒëa 13 d√≤ng -->
    <div class="table-scroll-container">
      <table class="table-no">
        <thead>
          <tr>
            <th>M√£ SPCT</th>
            <th>T√™n</th>
            <th>M√†u</th>
            <th>Size</th>
            <th>S·ªë l∆∞·ª£ng n·ª£</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let sp of danhSachSanPhamNo">
            <td>{{ sp.maSPCT }}</td>
            <td>{{ sp.tenSanPham }}</td>
            <td>{{ sp.mauSac }}</td>
            <td>{{ sp.size }}</td>
            <td>{{ sp.soLuongThieu }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>


  <!-- b·∫£ng ƒë∆°n h√†ng -->
  <table border="1" cellpadding="5" cellspacing="0">
    <thead>
      <tr>
        <th>M√£ h√≥a ƒë∆°n</th>
        <th>T√™n kh√°ch h√†ng</th>
        <th>S·ªë ƒëi·ªán tho·∫°i</th>
        <th>T·ªïng ti·ªÅn tr∆∞·ªõc voucher</th>
        <th>Ph∆∞∆°ng th·ª©c thanh to√°n</th>
        <th>Voucher</th>
        <th>T·ªïng ti·ªÅn thanh to√°n</th>
        <th>Tr·∫°ng th√°i thanh to√°n</th>
        <th>Xem chi ti·∫øt</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let hoaDon of fullHoaDonList">
        <td>{{ hoaDon.ma }}</td>
        <td>{{ hoaDon.tenNguoiNhan }}</td>
        <td>{{hoaDon.sdtNguoiNhan}}</td>
        <td>{{ hoaDon.tongTienTruocVoucher}}</td>
        <td>{{ hoaDon.phuongThucThanhToan.ten}}</td>
        <td>{{ hoaDon.voucher ? hoaDon.voucher.ten : 'Kh√¥ng √°p d·ª•ng' }}</td>
        <td>{{ hoaDon.tongTienThanhToan}}</td>
        <td>
          <button class="xac-nhan" *ngIf="hoaDon.trangThai !== 5 && hoaDon.trangThai !== 9" (click)="updateTrangThai(hoaDon.id,hoaDon.trangThai)">
            {{ getButtonLabel(hoaDon.trangThai) }}
          </button>
          <span *ngIf="hoaDon.trangThai === 9">ƒê∆°n ƒë√£ h·ªßy</span>
          <span *ngIf="hoaDon.trangThai === 5">Giao h√†ng th√†nh c√¥ng</span>
        </td>
        <td>
          <button class="xem-chi-tiet" (click)="chonDonHang(hoaDon.id)">
            <i class="bi bi-eye-fill"></i>
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- ph√¢n trang -->
  <div class="pagination">
    <!-- l√πi 1 trang -->
    <button class="preve" (click)="changePage(page - 1)" [disabled]="page === 0">
      <i class="bi bi-chevron-double-left"></i>
    </button>

    <!-- s·ªë trang -->
    <span style="margin-top: 10px;">{{ page + 1 }} / {{ totalPages }}</span>

    <!-- ti·∫øn 1 trang -->
    <button class="next" (click)="changePage(page + 1)" [disabled]="page === totalPages - 1">
      <i class="bi bi-chevron-double-right"></i>
    </button>
  </div>


  <!-- Modal chi ti·∫øt -->
  <div class="modal" *ngIf="showDetailPopup">
    <div class="modal-content">
      <div class="modal-body">
        <div *ngIf="hoaDonData" class="invoice-container">
          <!-- M√£ h√≥a ƒë∆°n (CƒÉn ph·∫£i) -->
          <div class="invoice-header">
            <h3>Chi ti·∫øt ƒë∆°n h√†ng</h3>
            <p class="invoice-code"><strong>M√£ ƒë∆°n h√†ng:</strong> {{ hoaDonData.ma }}</p>
          </div>

          <div class="status-tracker" *ngIf="hoaDonData.trangThai != 9">
            <div class="status-step" [class.active]="hoaDonData.trangThai == 1" style="margin-top: 20px;">
              <div class="status-icon">üìÑ</div>
              <p>Ch·ªù x√°c nh·∫≠n</p>
              <span style="margin-top: 4px; font-size: 0.8rem; color: gray;">{{hoaDonData.ngayTao}}</span>
            </div>

            <div class="status-line" [class.active]="hoaDonData.trangThai == 2"></div>
            <div class="status-step" [class.active]="hoaDonData.trangThai == 2">
              <div class="status-icon">‚úîÔ∏è</div>
              <p>ƒê√£ x√°c nh·∫≠n</p>
            </div>

            <div class="status-line" [class.active]="hoaDonData.trangThai == 3"></div>
            <div class="status-step" [class.active]="hoaDonData.trangThai == 3">
              <div class="status-icon">‚è≥</div>
              <p>Ch·ªù l·∫•y h√†ng</p>
            </div>

            <div class="status-line" [class.active]="hoaDonData.trangThai == 4"></div>
            <div class="status-step" [class.active]="hoaDonData.trangThai == 4">
              <div class="status-icon">üöö</div>
              <p>ƒêang giao h√†ng</p>
            </div>

            <div class="status-line" [class.active]="hoaDonData.trangThai == 5"></div>
            <div class="status-step" [class.active]="hoaDonData.trangThai == 5" style="margin-top: 10px;">
              <div class="status-icon">üì¶</div>
              <p>Giao h√†ng th√†nh c√¥ng</p>
              <span style="margin-top: 4px; font-size: 0.8rem; color: gray;">{{hoaDonData.ngaySua}}</span>
            </div>

          </div>
          <!-- N·∫øu tr·∫°ng th√°i h√≥a ƒë∆°n l√† 9 (ƒê∆°n h√†ng ƒë√£ h·ªßy), ch·ªâ hi·ªÉn th·ªã th√¥ng b√°o n√†y -->
          <div *ngIf="hoaDonData.trangThai == 9">
            <div class="cancelHoaDon">
              <p><i class="bi bi-x-circle"></i> ƒê∆°n h√†ng ƒë√£ b·ªã h·ªßy</p>
              <!-- Ch·ªâ hi·ªÉn th·ªã n·∫øu tr·∫°ng th√°i = 9 -->
              <p *ngIf="hoaDonData?.trangThai === 9 && hoaDonData?.ghiChu" style="font-size: 15px;color: black;">
                (L√Ω do h·ªßy ƒë∆°n: {{ hoaDonData.ghiChu }})
              </p>
            </div>

          </div>

          <!-- ƒê·ªãa ch·ªâ nh·∫≠n h√†ng -->
          <section class="section" style="margin-top: 30px;">
            <h3>Th√¥ng tin kh√°ch h√†ng</h3>
            <p><strong>T√™n ng∆∞·ªùi nh·∫≠n:</strong> {{ hoaDonData.tenNguoiNhan }} (+84 | {{ hoaDonData.sdtNguoiNhan }})</p>
            <!-- Ch·ªâ hi·ªÉn th·ªã n·∫øu ƒë·ªãa ch·ªâ kh√°ch h√†ng c√≥ d·ªØ li·ªáu -->
            <p *ngIf="hoaDonData.diaChiNhanHang"><strong>ƒê·ªãa ch·ªâ:</strong> {{ hoaDonData.diaChiNhanHang }}</p>
          </section>

          <!-- Chi ti·∫øt h√≥a ƒë∆°n -->
          <section class="section">
            <div *ngFor="let item of chiTietHoaDonData" class="invoice-details-item">
              <img [src]="'http://localhost:8080' + item.anhUrls" alt="{{ item.tenSanPham }}" />
              <div class="invoice-details-info">
                <p><strong>T√™n S·∫£n Ph·∫©m:</strong> {{ item.tenSanPham }} ({{item.maSanPham}})</p>
                <p><strong>Ph√¢n lo·∫°i h√†ng: </strong>({{ item.mauSac }} / {{item.size}})</p>
                <p><strong>ƒê∆°n Gi√°:</strong> {{ item.donGia | number }} VND (x{{ item.soLuong }})</p>
                <p></p>
                <p><strong>Th√†nh Ti·ªÅn:</strong> {{ item.donGia * item.soLuong | number }} VNƒê</p>
              </div>
            </div>
          </section>

          <!-- Chi ti·∫øt thanh to√°n -->
          <section class="section">
            <p><strong>T·ªïng ti·ªÅn tr∆∞·ªõc voucher:</strong> {{ hoaDonData.tongTienTruocVoucher | number }} VNƒê</p>

            <!-- ƒêi·ªÅu ki·ªán hi·ªÉn th·ªã voucher v√† gi√° tr·ªã gi·∫£m -->
            <div *ngIf="hoaDonData.voucher">
              <p>
                <strong>T√™n voucher:</strong> {{ hoaDonData.voucher?.ten }}

                <!-- Hi·ªán n·∫øu gi·∫£m % v√† kh√¥ng v∆∞·ª£t gi·∫£m t·ªëi ƒëa -->
                <span *ngIf="showGiamPhanTram">
                  (Gi·∫£m: {{ hoaDonData.voucher?.giaTriGiam }}%)
                </span>

                <!-- Hi·ªán n·∫øu gi·∫£m % nh∆∞ng v∆∞·ª£t qu√° m·ª©c gi·∫£m t·ªëi ƒëa -->
                <span *ngIf="showGiamToiDa">
                  (Gi·∫£m t·ªëi ƒëa: {{ hoaDonData.voucher?.giamToiDa | number }} VNƒê)
                </span>

                <!-- Hi·ªán n·∫øu gi·∫£m b·∫±ng s·ªë ti·ªÅn -->
                <span *ngIf="hoaDonData.voucher?.hinhThucGiam === true">
                  (Gi·∫£m: {{ hoaDonData.voucher?.giaTriGiam | number }} VNƒê)
                </span>
              </p>
            </div>

            <!-- N·∫øu kh√¥ng c√≥ voucher th√¨ kh√¥ng hi·ªÉn th·ªã th√¥ng tin voucher -->
            <p *ngIf="!hoaDonData.voucher"><strong>H√≥a ƒë∆°n kh√¥ng √°p d·ª•ng voucher</strong></p>
            
            <p><strong>Ph∆∞∆°ng th·ª©c thanh to√°n:</strong> {{ hoaDonData.phuongThucThanhToan?.ten }}</p>
            <p *ngIf="hoaDonData.phiVanChuyen && hoaDonData.phiVanChuyen > 0">
              <strong>Ph√≠ v·∫≠n chuy·ªÉn:</strong> {{ hoaDonData.phiVanChuyen | number }} VNƒê
            </p>
            <p><strong>T·ªïng ti·ªÅn thanh to√°n:</strong> {{ hoaDonData.tongTienThanhToan | number }} VNƒê</p>
          </section>

          <!-- N√∫t H·ªßy v√† N√∫t Quay V·ªÅ Trang Ch·ªß -->
          <div class="btn">
            <button *ngIf="!([5,2,3,4].includes(hoaDonData.trangThai))" (click)="openCancelModal()" class="btn-danger">
              H·ªßy ƒë∆°n h√†ng
            </button>
            <button (click)="goHome()" class="btn-primary">ƒê√≥ng</button>
          </div>
          <!-- Modal nh·∫≠p l√Ω do h·ªßy -->
          <div class="modal-overlay-huy" *ngIf="showCancelModal">
            <div class="modal-huy">
              <h4>Nh·∫≠p l√Ω do h·ªßy ƒë∆°n h√†ng</h4>
              <textarea [(ngModel)]="ghiChu" rows="4" placeholder="Nh·∫≠p l√Ω do..."></textarea>
              <div class="modal-buttons">
                <button class="btn btn-danger" (click)="cancelHoaDon(hoaDonData.id)">X√°c nh·∫≠n h·ªßy</button>
                <button class="btn btn-secondary" (click)="closeCancelModal()">H·ªßy</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>